# 한글 스와이프 키보드 v5 (오토마타 엔진 통합)

## 🎯 개요

기존 스와이프 키보드 UI에 v5 한글 오토마타 엔진을 통합한 프로젝트입니다.

### 특징
- ✅ **4x5 그리드 레이아웃** - 20개 키 배치
- ✅ **4방향 스와이프** - 된소리, 거센소리, 획추가
- ✅ **v5 오토마타 엔진** - 완벽한 한글 조합 로직
- ✅ **백스페이스 완벽 지원** - 키 히스토리 기반 재조합
- ✅ **QWERTY 매핑** - 표준 키보드 레이아웃

## 📦 프로젝트 구조

```
HangulKeyboard_v5_integrated/
├── Core (v5 오토마타 엔진)
│   ├── HangulAutomata.swift           # State Machine
│   ├── HangulUnicodeConverter.swift   # 유니코드 변환
│   └── HangulInputEngine.swift        # 범용 입력 엔진
│
├── Model
│   └── KeyboardModel.swift            # 키 레이아웃 정의
│
├── ViewModel
│   └── KeyboardViewModel.swift        # v5 엔진 래퍼
│
├── View
│   ├── KeyboardView.swift             # 메인 키보드 UI
│   └── HangulKeyboardApp.swift        # 앱 진입점
│
└── Documentation
    ├── README.md                       # 이 파일
    └── INTEGRATION_GUIDE.md            # 통합 가이드
```

## 🚀 빠른 시작

### 1. Xcode 프로젝트 생성

```bash
# Xcode 15.0 이상
1. Create a new Xcode project
2. iOS App
3. Interface: SwiftUI
4. Project name: HangulKeyboard
```

### 2. 파일 추가

모든 `.swift` 파일을 프로젝트에 드래그 앤 드롭

### 3. 빌드 및 실행

- Target: iOS 16.0+
- **Command + R** 실행

## ⌨️ 키보드 레이아웃

### QWERTY 매핑

```
사용자 보기:         엔진 키:
[ㄱ] [ㄴ] [ㅢ] [⌫]   [r] [s] [m] [delete]
[ㄹ] [ㅁ] [ㅣ] [?]   [f] [a] [l] [?]
[ㅅ] [ㅇ] [ㅡ] [?123] [t] [d] [m] [toggle]
[ㅈ] [ㅎ] [..] [.]   [w] [g] [-] [.]
[ ] [␣] [@] [↵]     [empty] [space] [@] [enter]
```

### 스와이프 예시

**ㄱ 키:**
- 터치: ㄱ (r)
- ← 왼쪽: ㅋ (z)
- → 오른쪽: ㅋ (z)
- ↑ 위: ㄲ (R)

**ㅣ 키:**
- 터치: ㅣ (l)
- ← 왼쪽: ㅓ (j)
- → 오른쪽: ㅏ (k)
- ↑ 위: ㅗ (h)
- ↓ 아래: ㅜ (n)

## 💡 사용 예시

### "안녕" 입력

```
1. ㅇ 터치 (d)
2. ㅣ 아래로 스와이프 (l → j) → 'ㅓ'
3. ㄴ 터치 (s)
결과: '안'

4. ㄴ 터치 (s)
5. .. 아래로 스와이프 → 'ㅕ'
6. ㅇ 터치 (d)
결과: '녕'

최종: '안녕'
```

### "야야" 입력 (종성 분리 테스트)

```
1. ㅇ 터치 (d)
2. .. 오른쪽 스와이프 → 'ㅑ'
결과: '야'

3. ㅇ 터치 (d) → 종성으로
결과: '양'

4. .. 오른쪽 스와이프 → 'ㅑ'
   → 종성 'ㅇ' 분리되어 다음 글자 초성으로
결과: '야야' ✅
```

### "값" 입력 (겹받침)

```
1. ㄱ 터치 (r)
2. ㅣ 오른쪽 스와이프 → 'ㅏ'
결과: '가'

3. ㅁ 아래 스와이프 → 'ㅂ'
결과: '갑'

4. ㅅ 터치 (t) → 겹받침 'ㅂㅅ'
결과: '값' ✅
```

## 🔧 커스터마이징

### 1. 키 레이아웃 변경

`KeyboardModel.swift`의 `getQWERTYLayout()` 수정:

```swift
KeyboardKey(
    defaultValue: "표시할 한글",
    engineKey: "오토마타 엔진 키",
    left: ("왼쪽 한글", "엔진 키"),
    right: ("오른쪽 한글", "엔진 키"),
    // ...
)
```

### 2. 스와이프 민감도 조절

`KeyboardView.swift`의 `swipeThreshold` 변경:

```swift
private let swipeThreshold: CGFloat = 20  // 기본값
```

### 3. 복합 키 입력

여러 자모 조합이 필요한 경우:

```swift
KeyboardKey(
    defaultValue: "ㅘ",
    engineKey: "hk"  // h + k = ㅗ + ㅏ = ㅘ
)
```

## 🔍 디버깅

### 콘솔 로그 확인

```
[ViewModel] v5 엔진 통합 초기화
[v5 입력 엔진] 초기화
[v5 오토마타] 초기화

[ViewModel] 키 입력 - 기본:ㄱ 방향:none
[입력 엔진] 키: 'r'
[입력] 'r'
  [0] 'r' → 초성 'ㄱ'
      [초성] 추가
[결과] 초:ㄱ 중: 종: 완료:false
[입력 엔진] 화면: 'ㄱ'
[ViewModel] 화면 업데이트: 'ㄱ'
```

## 🧪 테스트

### 자동 테스트 버튼

앱 하단의 "테스트" 버튼 클릭:
- 자동으로 "야야" 입력
- 종성 분리 로직 확인

### 수동 테스트 케이스

1. **기본 조합**: ㄱ + ㅏ = '가'
2. **된소리**: ㄱ 위 스와이프 = 'ㄲ'
3. **종성 분리**: 야 + ㅇ + ㅑ = '야야'
4. **겹받침**: 갑 + ㅅ = '값'
5. **백스페이스**: 야야 → 양 → 야 → ㅇ

## 📚 기술 스택

- **SwiftUI**: UI 프레임워크
- **Combine**: 반응형 프로그래밍
- **State Machine**: 한글 조합 로직
- **Gesture**: 스와이프 입력 처리

## 🎨 UI/UX 특징

1. **시각적 피드백**: 터치 시 색상 변경
2. **스와이프 힌트**: 각 키 주변에 변환 가능 문자 표시
3. **실시간 상태**: 커밋/조합 중 텍스트 분리 표시
4. **햅틱 피드백**: 입력 시 촉각 피드백

## 🔑 핵심 기능

### v5 오토마타 엔진 통합

```swift
class KeyboardViewModel {
    private let engine = HangulInputEngine()
    
    func handleKeyInput(_ key: KeyboardKey, direction: SwipeDirection) {
        // 1. 방향에 따라 엔진 키 결정
        let engineKey = getEngineKey(key, direction)
        
        // 2. v5 엔진으로 처리
        engine.processKey(engineKey)
        
        // 3. 결과 반영
        displayText = engine.displayText
    }
}
```

### 키 히스토리 기반 백스페이스

v5 엔진이 자동으로 처리:
- 입력 키 히스토리 저장
- 백스페이스 시 히스토리에서 제거
- 전체 재조합으로 정확한 상태 복원

## 💡 개발 팁

1. **콘솔 로그**: 전체 흐름 파악의 핵심
2. **작은 단위 테스트**: 자음/모음 하나씩 테스트
3. **엔진 키 확인**: 영문 키와 한글 표시 구분

## ⚠️ 주의사항

1. **복합 키**: 여러 자모 조합 시 순서 중요 (예: hk ≠ kh)
2. **엔진 키**: 반드시 v5 오토마타가 인식하는 영문 키 사용
3. **스레드**: 메인 스레드에서만 ViewModel 업데이트

## 🚧 향후 개발 계획

- [ ] 숫자/특수문자 레이아웃 추가
- [ ] 키보드 Extension 지원
- [ ] 사용자 커스텀 레이아웃
- [ ] 학습 기능 (자주 쓰는 단어)

## 📞 문의

프로젝트 관련 문의사항이나 버그 리포트는 이슈로 등록해주세요.

---

**v5 오토마타 엔진 + 스와이프 UI = 완벽한 한글 입력기** 🚀
